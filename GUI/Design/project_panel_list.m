function handles = project_panel_list(list,index,handles)
%% Create the buttons, check boxes and delete icons for the projects being compared
quote='''';
%Delete any old buttons
num = num2str(length(list)+1);
if isfield(handles,strcat('System_',num))
    delete(handles.(strcat('System_',num)));
    delete(handles.(strcat('DeleteSys',num)));
    handles = rmfield(handles,strcat('System_',num));
end
set(handles.ProjectsPanel,'UserData',list)
set(handles.popupmenuBaseline,'String',list,'Value',index);
%make new buttons
nSys = length(list);
for i=1:1:nSys 
    num = num2str(i);
    if ~isfield(handles,strcat('System_',num))
        curtab = floor((i-1)/3)+1;
        prev = 3*(curtab-1);
        xpos = -20 + 24*(i-prev);
        if curtab==1
            vis = 'on';
        else
            vis = 'off';
        end
        if i == index
            foregroundC = [0 0 0];
            backgroundC = [1 1 1];
            height = 2;
        else
            foregroundC = [0.5 0.5 0.5];
            backgroundC = [1 1 .7];
            height = 1.8;
        end
        handles.(strcat('System_',num)) = uicontrol('Style', 'pushbutton', 'String', list{i},...
        'Units','characters',...
        'Position', [xpos 2.5 20 height],...
        'Tag', strcat('System_',num),...
        'FontSize', 10,...
        'Parent', handles.ProjectsPanel,...
        'Callback',eval(strcat('@(hObject,eventdata)MainScreen1(',quote,'System_Callback',quote,',hObject,eventdata,guidata(hObject))')),...
        'Visible',vis,...
        'UserData',i,...
        'ForegroundColor', foregroundC,'BackgroundColor',backgroundC);

        %% delete button
        handles.(strcat('DeleteSys',num)) = uicontrol('Style', 'pushbutton',...
        'Units','characters',...
        'Position', [xpos+15 0 5 2],...
        'Tag', strcat('DeleteSys',num),....
        'String','X','ForegroundColor','red','BackgroundColor',[.94,.94,.94],'FontSize',18,'FontWeight','bold',...
        'Parent', handles.ProjectsPanel,...
        'Callback',eval(strcat('@(hObject,eventdata)MainScreen1(',quote,'DeleteSys_Callback',quote,',hObject,eventdata,guidata(hObject))')),...
        'Visible',vis,'UserData',i);
    end
end
if nSys>1
    set(handles.popupmenuBaseline,'Visible','on');
    set(handles.text_baseline,'Visible','on');
else
    set(handles.popupmenuBaseline,'Visible','off');
    set(handles.text_baseline,'Visible','off');
end
%make prev and next buttons if they don't exist
if ~isfield(handles,'Copy')
    handles.PrevSys = uicontrol('Style', 'pushbutton', 'String', 'Prev',...
    'Units','characters','FontSize', 10,'Position', [5 0 15 1.8],...
    'Tag', 'PrevSys','Parent', handles.ProjectsPanel,...
    'Callback',eval(strcat('@(hObject,eventdata)MainScreen1(',quote,'PrevSys_Callback',quote,',hObject,eventdata,guidata(hObject))')),...
    'Visible','off','UserData',1);

    handles.NextSys = uicontrol('Style', 'pushbutton', 'String', 'Next',...
    'Units','characters','FontSize', 10,'Position', [70 0 15 1.8],...
    'Tag', 'NextSys','Parent', handles.ProjectsPanel,...
    'Callback',eval(strcat('@(hObject,eventdata)MainScreen1(',quote,'NextSys_Callback',quote,',hObject,eventdata,guidata(hObject))')),...
    'Visible','off','UserData',1);
    if nSys>3 
        set(handles.NextSys,'Visible','on');
    end

    %make copy, load, and save buttons
    handles.Copy = uicontrol('Style', 'pushbutton', 'String', 'Copy',...
    'Units','characters','FontSize', 10,'Position', [85 3.25 15 1.5],'BackgroundColor',[.76,.87,.78],...
    'Tag', 'Copy','Parent', handles.ProjectsPanel,...
    'Callback',eval(strcat('@(hObject,eventdata)MainScreen1(',quote,'Copy_Callback',quote,',hObject,eventdata,guidata(hObject))')),'Visible','on');

    handles.Load= uicontrol('Style', 'pushbutton', 'String', 'Load',...
    'Units','characters','FontSize', 10,'Position', [85 1.75 15 1.5],'BackgroundColor',[.3,.75,.93],...
    'Tag', 'Load','Parent', handles.ProjectsPanel,...
    'Callback',eval(strcat('@(hObject,eventdata)MainScreen1(',quote,'Load_Callback',quote,',hObject,eventdata,guidata(hObject))')),'Visible','on');

    handles.Save = uicontrol('Style', 'pushbutton', 'String', 'Save',...
    'Units','characters','FontSize', 10,'Position', [4 0 10 2],'BackgroundColor',[.85,.33,.10],...
    'Tag', 'Save','Parent', handles.ProjectsPanel,...
    'Callback',eval(strcat('@(hObject,eventdata)MainScreen1(',quote,'Save_Callback',quote,',hObject,eventdata,guidata(hObject))')),'Visible','on');
end